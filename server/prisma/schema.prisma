generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "mysql"
    url      = env("DATABASE_URL")
}

enum Role {
    ADMIN
    COURIER
    MANAGER
    GUEST
    CUSTOMER
}

enum OfferStatus {
    OFFERED
    ACCEPTED
    DECLINED
    ACTIVE
    SOLD
}

enum OrderStatus {
    FULFILLED
    UNFULFILLED
}

enum FulfillmentStatus {
    FULFILLED
    UNFULFILLED
}

enum PaymentStatus {
    UNPAID
    PARTIALLY_PAID
    NEED_TO_RETURN
    REFUNDED
    PAID
}

model VerificationCode {
    id        String   @id @default(cuid())
    email     String
    code      String
    createdAt DateTime @default(now())
}

model User {
    id                   String            @id @default(cuid())
    email                String?           @unique
    phone                String?
    firstName            String?
    lastName             String?
    inn                  String?
    account              String?
    correspondentAccount String?
    bic                  String?
    passport             String?
    comment              String?
    isVerified           Boolean           @default(false)
    isSubscribed         Boolean           @default(false)
    role                 Role              @default(GUEST)
    addresses            Address[]
    orders               Order[]
    favoriteProducts     FavoriteProduct[]
    tokens               Token[]
    cart                 CartProduct[]
    offer                Offer[]
    createdAt            DateTime          @default(now())
    updatedAt            DateTime          @updatedAt
}

model CartProduct {
    user      User     @relation(fields: [userId], references: [id])
    userId    String
    offer     Offer    @relation(fields: [offerId], references: [id])
    offerId   String
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@id([userId, offerId])
}

model Token {
    id           String   @id @default(cuid())
    user         User     @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
    userId       String
    refreshToken String
    expiresIn    DateTime
    createdAt    DateTime @default(now())
}

model Address {
    id        String   @id @default(cuid())
    country   String
    city      String
    address   String
    region    String
    user      User     @relation(fields: [userId], references: [id])
    userId    String
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model Order {
    id             String         @id @default(cuid())
    paymentStatus  PaymentStatus
    totalPrice     Int
    totalShiping   Int
    paid           Int            @default(0)
    mailingCountry String
    mailingCity    String
    mailingRegion  String
    mailingAddress String
    comment        String?
    products       OrderProduct[]
    fulfillments   Fulfillment[]
    timeline       Timeline[]
    user           User           @relation(fields: [userId], references: [id])
    userId         String
    createdAt      DateTime       @default(now())
    updatedAt      DateTime       @updatedAt
}

model Timeline {
    id        String   @id @default(cuid())
    message   String
    order     Order    @relation(fields: [orderId], references: [id])
    orderId   String
    createdAt DateTime @default(now())
}

model Fulfillment {
    id               String            @id @default(cuid())
    title            String
    status           FulfillmentStatus
    tracking         String
    shippingTitle    Int
    shippingPrice    Int
    shippingDuration Int
    orderProduct     OrderProduct[]
    order            Order             @relation(fields: [orderId], references: [id])
    orderId          String
    createdAt        DateTime          @default(now())
    updatedAt        DateTime          @updatedAt
}

model OrderProduct {
    id            String       @id @default(cuid())
    price         Int
    order         Order        @relation(fields: [orderId], references: [id])
    orderId       String
    variant       Variant      @relation(fields: [variantId], references: [id])
    variantId     String
    offer         Offer        @relation(fields: [offerId], references: [id])
    offerId       String       @unique
    fulfillment   Fulfillment? @relation(fields: [fulfillmentId], references: [id])
    fulfillmentId String?
    createdAt     DateTime     @default(now())
    updatedAt     DateTime     @updatedAt
}

model FavoriteProduct {
    product   Product  @relation(fields: [productId], references: [id])
    productId String
    user      User     @relation(fields: [userId], references: [id])
    userId    String
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@id([productId, userId])
}

model Collection {
    id          String    @id @default(cuid())
    title       String    @unique
    description String
    products    Product[]
    image       Image     @relation(fields: [imageId], references: [id])
    imageId     String
    createdAt   DateTime  @default(now())
    updatedAt   DateTime  @updatedAt
}

model Product {
    id               String            @id @default(cuid())
    handle           String            @unique
    title            String
    vendor           String
    description      String
    metaTitle        String
    metaDescription  String
    available        Boolean           @default(false)
    images           ProductImage[]
    collections      Collection[]
    variants         Variant[]
    productIsFavored FavoriteProduct[]
    productOptions   ProductOption[]
    createdAt        DateTime          @default(now())
    updatedAt        DateTime          @updatedAt
}

model ProductOption {
    id        String   @id @default(cuid())
    title     String
    position  Int
    product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade, onUpdate: Cascade)
    productId String
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model ProductImage {
    id          String   @id @default(cuid())
    mediaType   String
    width       Int
    height      Int
    src         String
    alt         String
    aspectRatio Float
    path        String
    position    Int
    product     Product? @relation(fields: [productId], references: [id])
    productId   String?
    createdAt   DateTime @default(now())
    updatedAt   DateTime @updatedAt
}

model Variant {
    id             String         @id @default(cuid())
    title          String
    price          Int
    compareAtPrice Int?
    option1        String
    option2        String?
    option3        String?
    SKU            String?
    barcode        String?
    product        Product        @relation(fields: [productId], references: [id])
    productId      String
    image          Image          @relation(fields: [imageId], references: [id])
    imageId        String
    offers         Offer[]
    orders         OrderProduct[]
    createdAt      DateTime       @default(now())
    updatedAt      DateTime       @updatedAt
}

model Image {
    id          String       @id @default(cuid())
    mediaType   String
    width       Int
    height      Int
    src         String
    alt         String
    aspectRatio Float
    path        String
    variants    Variant[]
    collections Collection[]
    createdAt   DateTime     @default(now())
    updatedAt   DateTime     @updatedAt
}

model Offer {
    id                String           @id @default(cuid())
    price             Int
    compareAtPrice    Int?
    offersPrice       Int
    status            OfferStatus      @default(OFFERED)
    variant           Variant          @relation(fields: [variantId], references: [id])
    variantId         String
    user              User             @relation(fields: [userId], references: [id])
    userId            String
    order             OrderProduct?
    deliveryProfile   DeliveryProfile? @relation(fields: [deliveryProfileId], references: [id])
    deliveryProfileId String?
    cartProduct       CartProduct[]
    createdAt         DateTime         @default(now())
    updatedAt         DateTime         @updatedAt
}

model DeliveryProfile {
    id        String         @id @default(cuid())
    title     String
    offers    Offer[]
    zones     DeliveryZone[]
    createdAt DateTime       @default(now())
    updatedAt DateTime       @updatedAt
}

model DeliveryZone {
    id                String           @id @default(cuid())
    country           String
    region            String
    options           DeliveryOption[]
    deliveryProfile   DeliveryProfile  @relation(fields: [deliveryProfileId], references: [id])
    deliveryProfileId String
    createdAt         DateTime         @default(now())
    updatedAt         DateTime         @updatedAt

    @@unique([deliveryProfileId, country, region])
}

model DeliveryOption {
    id             String       @id @default(cuid())
    title          String
    price          Int
    duration       Int
    deliveryZone   DeliveryZone @relation(fields: [deliveryZoneId], references: [id])
    deliveryZoneId String
    createdAt      DateTime     @default(now())
    updatedAt      DateTime     @updatedAt
}

model Country {
    id        String   @id @default(cuid())
    title     String   @unique
    regions   Region[]
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model Region {
    id        String   @id @default(cuid())
    title     String
    cities    City[]
    country   Country  @relation(fields: [countryId], references: [id])
    countryId String
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@unique([countryId, title])
}

model City {
    id        String   @id @default(cuid())
    title     String
    region    Region   @relation(fields: [regionId], references: [id])
    regionId  String
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@unique([regionId, title])
}
